import pandas as pd
import json
# import numpy as np
import matplotlib.pyplot as plt


def handle(params, Bot):
    true_info_str = params.get("true_info").replace('\'', '\"')
    true_info = json.loads(true_info_str)

    event_behavior_data_str = params.get("event_info").replace('\'', '\"')
    event_behavior_data = json.loads(event_behavior_data_str)

    dict_data = dict(event_behavior_data, **true_info, **Bot)
    data = pd.DataFrame(dict_data)
    print(data.head())

    return data, true_info["scenario"]


def visualization(df):
    plt.scatter(df['Time'], df['op_x'], marker='x')
    plt.show()


def save_file_to_csv(dataframe, save_file):
    dataframe.to_csv(save_file, index=None)


if __name__ == "__main__":
    {"event_info": "{\"Action\":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,13],\"event_type\":[2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,3],\"Time\":[1530117019698,1530117019830,1530117019846,1530117019863,1530117019880,1530117019897,1530117019913,1530117019929,1530117019947,1530117019964,1530117019981,1530117019997,1530117020014,1530117020030,1530117020046,1530117020063,1530117020080,1530117020097,1530117020113,1530117020130,1530117020147,1530117020164,1530117020180,1530117020197,1530117020213,1530117020230,1530117020247,1530117020263,1530117020297,1530117020347,1530117020382,1530117020431,1530117020448,1530117020464,1530117020481,1530117020498,1530117020514,1530117020532,1530117020549,1530117020565,1530117020584,1530117020600,1530117020615,1530117020632,1530117020649,1530117020681,1530117020748,1530117020815,1530117020898,1530117020949,1530117020982,1530117020998,1530117021015,1530117021032,1530117021066,1530117021116,1530117021167,1530117021200,1530117021334,1530117021467,1530117021533,1530117021636,1530117021651,1530117021768,1530117022035,1530117022237,1530117022248],\"op_x\":[39,52,60,64,70,78,86,89,96,100,107,111,118,121,127,130,135,140,144,146,151,155,156,158,159,161,161,162,162,163,162,161,160,160,159,158,157,157,155,154,153,153,152,152,151,151,150,150,149,149,148,147,147,146,146,145,145,144,144,143,143,142,142,141,141,140,140],\"op_y\":[250,254,256,257,259,260,261,260,261,261,261,261,262,262,262,263,263,263,263,263,264,265,264,265,265,265,266,266,266,267,267,267,267,268,268,268,269,269,269,270,270,270,270,270,271,270,270,270,271,271,271,271,271,271,271,271,271,271,271,271,271,271,270,270,270,271,271]}","verify_info": "{\"correct_y\":161,\"correct_x\":119,\"scenario\":1,\"slidebarleft_x\":15,\"slidebarleft_y\":230,\"slidebarright_y\":270,\"terminal\":1,\"slidebarright_x\":57}","sensor_info": "{\"Time_Pres\":[4412,4429,4446,4463,4479,4496,4513,4529,4546,4563,4579,4596,4613,4630,4647,4663,4680,4696,4713,4730,4746,4763,4780,4797,4813,4830,4846,4863],\"Sensor_Pres\":[1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0]}"}
    Bot = {'Bot': 0}
    dfparse, scenario = handle(da, Bot)
    print(dfparse)
    visualization(dfparse)

    # base_dir = "/Users/kite/Desktop/"
    save_base_dir = "/Users/kite/Desktop/Mobile_verify/Data/trainData/H5/"

    if scenario == 0:
        scenario_name = "phase1"
    elif scenario == 1:
        scenario_name = "phase2"
    else:
        scenario_name = "other_phase"
    file_tag = "and_wrong_human_decision_201806281042"
    save_file_name = save_base_dir + scenario_name + file_tag + ".csv"
    save_file_to_csv(dfparse, save_file_name)
