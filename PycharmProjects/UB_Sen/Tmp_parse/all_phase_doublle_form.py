import pandas as pd
import json
# import numpy as np
import matplotlib.pyplot as plt


def handle(params):
    true_info_str = params.get("true_info").replace('\'', '\"')
    true_info = json.loads(true_info_str)

    event_behavior_data_str = params.get("event_info").replace('\'', '\"')
    event_behavior_data = json.loads(event_behavior_data_str)

    dict_data = dict(event_behavior_data, **true_info)
    data = pd.DataFrame(dict_data)
    print(data.head())

    return data, true_info["scenario"]


def visualization(df):
    plt.scatter(df['Time'], df['op_x'], marker='x')
    plt.show()


def save_file_to_csv(dataframe, save_file):
    dataframe.to_csv(save_file, index=None)


if __name__ == "__main__":
    da = {"event_info": "{\"Action\":[\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"12\",\"0\",\"0\",\"12\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"12\",\"0\",\"12\",\"0\",\"12\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"13\"],\"event_type\":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\"Time\":[1520616362932,1520616362949,1520616362967,1520616362982,1520616362999,1520616363016,1520616363033,1520616363049,1520616363066,1520616363082,1520616363099,1520616363115,1520616363131,1520616363148,1520616363166,1520616363182,1520616363199,1520616363216,1520616363232,1520616363250,1520616363266,1520616363282,1520616363299,1520616363316,1520616363334,1520616363349,1520616363365,1520616363382,1520616363399,1520616363416,1520616363434,1520616363448,1520616363465,1520616363483,1520616363499,1520616363514,1520616363533,1520616363548,1520616363565,1520616363582,1520616363598,1520616363615,1520616363632,1520616363648,1520616363665,1520616363682,1520616363698,1520616363715,1520616363732,1520616363748,1520616363766,1520616363782,1520616363798,1520616363816,1520616363832,1520616363848,1520616363865,1520616363882,1520616364198,1520616364398,1520616364448,1520616364798,1520616364932,1520616364948,1520616364964,1520616364981,1520616364998,1520616365015,1520616365031,1520616365041,1520616365398,1520616375699,1520616375998,1520616377133,1520616377139,1520616377148,1520616377149,1520616377166,1520616377167,1520616377182,1520616377183,1520616377199,1520616377200,1520616377216,1520616377217,1520616377232,1520616377233,1520616377249,1520616377250,1520616377266,1520616377267,1520616377283,1520616377284,1520616377299,1520616377300,1520616377315,1520616377316,1520616377331,1520616377333,1520616377350,1520616377351,1520616377366,1520616377367,1520616377383,1520616377383,1520616377399,1520616377400,1520616377416,1520616377418,1520616377432,1520616377433,1520616377448,1520616377449,1520616377467,1520616377467,1520616377483,1520616377483,1520616377498,1520616377499,1520616377515,1520616377516,1520616377532,1520616377533,1520616377550,1520616377550,1520616377565,1520616377566,1520616377582,1520616377583,1520616377600,1520616377601,1520616377616,1520616377617,1520616377633,1520616377634,1520616377649,1520616377650,1520616377666,1520616377667,1520616377682,1520616377682,1520616377691],\"op_x\":[228,229,229,230,231,231,232,232,233,233,233,234,234,234,234,235,235,235,236,236,236,237,237,237,238,238,239,239,240,240,241,241,241,242,242,243,243,243,244,244,245,245,246,246,247,247,248,249,250,251,252,253,253,254,254,255,255,255,255,255,255,255,256,261,272,285,303,325,352,365,365,138,138,461,461,462,462,463,463,468,468,473,473,476,476,481,481,483,483,486,486,490,490,491,491,493,493,494,494,496,496,501,501,504,504,506,506,511,511,514,514,518,518,521,521,525,525,527,527,529,529,532,532,537,537,539,539,542,542,544,544,546,546,549,549,553,553,556,556,558,558,558],\"op_y\":[1104,1104,1105,1105,1105,1106,1106,1106,1106,1106,1107,1107,1107,1107,1107,1107,1107,1107,1107,1107,1107,1107,1107,1107,1107,1107,1107,1107,1107,1107,1107,1107,1107,1107,1107,1107,1107,1106,1106,1106,1106,1106,1106,1106,1106,1106,1106,1106,1106,1106,1106,1107,1107,1107,1107,1107,1107,1107,1107,1107,1107,1107,1107,1108,1113,1120,1129,1143,1161,1171,1171,1016,1016,952,952,953,953,954,954,955,955,956,956,957,957,958,958,959,959,960,960,961,961,962,962,963,963,964,964,965,965,966,966,967,967,968,968,969,969,970,970,971,971,972,972,973,973,974,974,975,975,976,976,977,977,978,978,979,979,980,980,981,981,982,982,983,983,984,984,985,985,985]}","true_info": "{\"correct_y\":789,\"correct_x\":540,\"scenario\":1,\"slidebarleft_x\":440,\"slidebarleft_y\":932,\"slidebarright_y\":972,\"terminal\":0,\"slidebarright_x\":482}"}
    dfparse, scenario = handle(da)
    print(dfparse)
    visualization(dfparse)

    # base_dir = "/Users/kite/Desktop/"
    save_base_dir = "/Users/kite/Desktop/Mobile_verify/Data/trainData/PC/"

    if scenario == 0:
        scenario_name = "phase1"
    elif scenario == 1:
        scenario_name = "phase2"
    else:
        scenario_name = "other_phase"
    file_tag = "wrong_decision_0"
    save_file_name = save_base_dir + scenario_name + file_tag + ".csv"
    # save_file_to_csv(dfparse, save_file_name)
