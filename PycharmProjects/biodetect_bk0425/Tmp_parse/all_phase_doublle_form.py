import pandas as pd
import json
# import numpy as np
import matplotlib.pyplot as plt


def handle(params, Bot):
    true_info_str = params.get("true_info").replace('\'', '\"')
    true_info = json.loads(true_info_str)

    event_behavior_data_str = params.get("event_info").replace('\'', '\"')
    event_behavior_data = json.loads(event_behavior_data_str)

    dict_data = dict(event_behavior_data, **true_info, **Bot)
    data = pd.DataFrame(dict_data)
    print(data.head())

    return data, true_info["scenario"]


def visualization(df):
    plt.scatter(df['Time'], df['op_x'], marker='x')
    plt.show()


def save_file_to_csv(dataframe, save_file):
    dataframe.to_csv(save_file, index=None)


if __name__ == "__main__":
    da = {"event_info": "{\"Action\":[\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"12\",\"0\",\"12\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"13\"],\"event_type\":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\"Time\":[1524555077457,1524555077475,1524555077491,1524555077507,1524555077525,1524555077541,1524555077590,1524555077607,1524555077624,1524555077640,1524555077657,1524555077890,1524555077907,1524555077924,1524555077940,1524555078192,1524555085142,1524555085149,1524555085158,1524555085158,1524555085174,1524555085175,1524555085191,1524555085192,1524555085207,1524555085209,1524555085225,1524555085226,1524555085241,1524555085242,1524555085258,1524555085258,1524555085275,1524555085276,1524555085292,1524555085293,1524555085308,1524555085309,1524555085324,1524555085325,1524555085341,1524555085342,1524555085358,1524555085359,1524555085375,1524555085375,1524555085392,1524555085393,1524555085408,1524555085409,1524555085425,1524555085428,1524555085442,1524555085442,1524555085457,1524555085458,1524555085475,1524555085476,1524555085491,1524555085492,1524555085508,1524555085508,1524555085525,1524555085526,1524555085541,1524555085542,1524555085557,1524555085558,1524555085574,1524555085576,1524555085592,1524555085594,1524555085608,1524555085608,1524555085626,1524555085627,1524555085633],\"op_x\":[1152,1157,1161,1164,1165,1165,1164,1163,1161,1160,1159,1161,1167,1179,1193,1193,461,461,466,466,469,469,471,471,472,472,474,474,476,476,481,481,486,486,487,487,491,491,494,494,497,497,502,502,505,505,508,508,510,510,515,515,520,520,521,521,526,526,528,528,531,531,534,534,537,537,539,539,540,540,541,541,545,545,544,544,544],\"op_y\":[467,473,478,481,482,483,483,481,479,477,477,477,477,477,481,481,912,912,913,913,914,914,915,915,916,916,917,917,918,918,919,919,920,920,921,921,922,922,923,923,924,924,925,925,926,926,927,927,928,928,929,929,930,930,931,931,932,932,933,933,934,934,935,935,936,936,937,937,938,938,939,939,940,940,941,941,941]}","true_info": "{\"correct_y\":747,\"correct_x\":526,\"scenario\":1,\"slidebarleft_x\":440,\"slidebarleft_y\":892,\"slidebarright_y\":932,\"terminal\":0,\"slidebarright_x\":482}"}
    Bot = {'Bot': 1}
    dfparse, scenario = handle(da, Bot)
    print(dfparse)
    visualization(dfparse)

    # base_dir = "/Users/kite/Desktop/"
    save_base_dir = "/Users/kite/Desktop/Mobile_verify/Data/trainData/PC/"

    if scenario == 0:
        scenario_name = "phase1"
    elif scenario == 1:
        scenario_name = "phase2"
    else:
        scenario_name = "other_phase"
    file_tag = "wrong_decision_201804241949"
    save_file_name = save_base_dir + scenario_name + file_tag + ".csv"
    save_file_to_csv(dfparse, save_file_name)
