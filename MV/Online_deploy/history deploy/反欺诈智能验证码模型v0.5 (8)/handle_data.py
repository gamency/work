# -*- coding: utf-8 -*-
from master_lightsaber import lightsaber
import pickle
import pandas as pd
import os
import demjson
import json
import numpy as np


file_path = os.path.split(os.path.realpath(__file__))[0]

JEDI1 = pickle.load(open(file_path + os.sep + "/Model/201801222036_bio_stage1xgpc.sav", 'r'))
JEDI2 = pickle.load(open(file_path + os.sep + "/Model/20180191134_bio_stage2xgpc.sav", 'r'))


def handle(params):
    event_behavior_data_str = params.get("event_info")
    true_info_str = params.get("true_info")
    print(str(event_behavior_data_str))
    event_behavior_data = demjson.decode(str(event_behavior_data_str))
    true_info = demjson.decode(str(true_info_str))

    # event_behavior_data = params.get("event_info")
    # true_info = params.get("true_info")

    # event_behavior_data = json.loads(json.dumps(event_behavior_data_str))

    data = pd.DataFrame(event_behavior_data)

    de = 0.59631
    if true_info["scenario"] == 0:
        JEDI = JEDI1
    elif true_info["scenario"] == 1:
        JEDI = JEDI2
    else:
        return {"Bot": str(de)}

    try:
        result = lightsaber(data, JEDI, true_info)
        print(result)
    except:
        print("get error here")
        return {"Bot": str(de)}
    #else:
        # TODO: write code...
    #finally:
        # TODO: write code...
    #result = lightsaber(data, JEDI, true_info)
    result = np.float(result)
    #print(result)

    return {"Bot": str(result)}


if __name__ == "__main__":
    # params =  {"event_info": { "Time": [1515639896196, 1238912], "event_type": [0, 1], "op_x": [681, 684],   "op_y": [538,  549],  "Action": ["_", "_"], "slidebarleft_x":[529.0, 530.0], "slidebarleft_y": [457.5, 458.8], "slidebarright_x": [565.0, 678], "slidebarright_y": [493.5,499] }}
    #params = '{"event_info": { "Time": [1515639896196, 1515639896296], "event_type": [0, 1], "op_x": [681, 684],   "op_y": [538,  549],  "Action": ["_", "_"]}, "true_info": {"correct_x": 595.0, "correct_y": 302.5, "slidebarleft_x": 529.0, "slidebarleft_y": 457.5, "slidebarright_x": 565.0,"slidebarright_y": 493.5, "scenario": 1, "terminal": 0}}'
    #params = {"event_info": {"Time": [1515639896196, 1515639896296], "event_type": [0, 1], "op_x": [681, 684], "op_y": [538, 549], "Action": ["_", "_"]}, "true_info": {"correct_x": 595.0, "correct_y": 302.5, "slidebarleft_x": 529.0, "slidebarleft_y": 457.5, "slidebarright_x": 565.0, "slidebarright_y": 493.5, "scenario": 1, "terminal": 0}}
    # params = {"event_info":[{"Time":1515639896196,  "event_type":0, "op_x":681, "op_y":538,  "Action":"_",  "correct_x":595.0, "correct_y":302.5, "slidebarleft_x":529.0, "slidebarleft_y":457.5, "slidebarright_x":565.0, "slidebarright_y":493.5},  {"Time":1515639896196,  "event_type":0, "op_x": 681, "op_y": 538,  "Action": "_", "correct_x":595.0, "correct_y":302.5, "slidebarleft_x":529.0, "slidebarleft_y":457.5, "slidebarright_x":565.0, "slidebarright_y":493.5}]}
    # params = {"event_info": [{"Time": 1515639896196, "event_type": 0, "op_x": 681, "op_y": 538, "Action": "_", },{"Time": 1515639896196, "event_type": 0, "op_x": 681, "op_y": 538, "Action": "_"}], "true_info": [{"correct_x": 595.0, "correct_y": 302.5, "slidebarleft_x": 529.0, "slidebarleft_y": 457.5, "slidebarright_x": 565.0,"slidebarright_y": 493.5}]}
    #params = {"event_info":"{\"mouse_event_type\":[1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,3,0,0,0,0,0,0,0,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,2,3,0,0,0,0,1,1,1,1,1,0,1,1,1,1,0,1,1,1,1,1,1,0,1,0,1,1,1,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,2,3],\"Action\":[\"38\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"38\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"38\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"38\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"38\",\"0\",\"36\",\"0\",null,\"0\",null,null,\"0\",null,null,\"0\",\"0\",\"0\",null,\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"38\",\"0\",\"36\",null,null,null,\"0\",\"0\",\"0\",\"0\",\"0\",\"38\",null,\"0\",\"0\",\"0\",\"0\",null,\"0\",\"0\",\"0\",\"0\",\"0\",\"38\",null,\"0\",null,\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",null,\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"38\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"38\",\"0\",\"0\",\"36\"],\"key_event_type\":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,0,7,6,0,6,7,0,0,0,7,0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,7,0,0,0,0,0,0,6,0,0,0,0,7,0,0,0,0,0,0,6,0,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\"Time\":[1516699395959,1516699397507,1516699397513,1516699397658,1516699397776,1516699397816,1516699397826,1516699397842,1516699397861,1516699397884,1516699397891,1516699397912,1516699398000,1516699398025,1516699398042,1516699398058,1516699398075,1516699398091,1516699398108,1516699398125,1516699398142,1516699398158,1516699398175,1516699398191,1516699398208,1516699398225,1516699398242,1516699398264,1516699398286,1516699398304,1516699398312,1516699398325,1516699398342,1516699398358,1516699398375,1516699398375,1516699398375,1516699398375,1516699398375,1516699398375,1516699398375,1516699398375,1516699398375,1516699398375,1516699398375,1516699398375,1516699398375,1516699398375,1516699398375,1516699398375,1516699398375,1516699398375,1516699398721,1516699399122,1516699399288,1516699399295,1516699399309,1516699399327,1516699399345,1516699399363,1516699399376,1516699399392,1516699399409,1516699399424,1516699399725,1516699400817,1516699400827,1516699400843,1516699400859,1516699400877,1516699400893,1516699400910,1516699400927,1516699400946,1516699401207,1516699401219,1516699401227,1516699401244,1516699401261,1516699401280,1516699401293,1516699401310,1516699401328,1516699401328,1516699401328,1516699401328,1516699401328,1516699401328,1516699401328,1516699401328,1516699401328,1516699401328,1516699401328,1516699401328,1516699401328,1516699401328,1516699401328,1516699401328,1516699401328,1516699401328,1516699401328,1516699401328,1516699401328,1516699401328,1516699401328,1516699401328,1516699401328,1516699401328,1516699401328,1516699401328,1516699401328,1516699401328,1516699401328,1516699401328,1516699401328,1516699401328,1516699401328,1516699401722,1516699401923,1516699402126,1516699402145,1516699402162,1516699402177,1516699402194,1516699402210,1516699402227,1516699402245,1516699402265,1516699402277,1516699402295,1516699402311,1516699402329,1516699402344,1516699402361,1516699402593,1516699402612,1516699402923,1516699403038,1516699403122,1516699403179,1516699403288,1516699403324,1516699403396,1516699403435,1516699403522,1516699403530,1516699403538,1516699403538,1516699403561,1516699403578,1516699403595,1516699403611,1516699403628,1516699403644,1516699403661,1516699403677,1516699403694,1516699403711,1516699403728,1516699403937,1516699403944,1516699404157,1516699404172,1516699404299,1516699404327,1516699404375,1516699404382,1516699404395,1516699404412,1516699404416,1516699404416,1516699404428,1516699404445,1516699404461,1516699404463,1516699404464,1516699404478,1516699404495,1516699404511,1516699404528,1516699404544,1516699404561,1516699404572,1516699404595,1516699404612,1516699404640,1516699404655,1516699404688,1516699404688,1516699404688,1516699404688,1516699404688,1516699404688,1516699404688,1516699404688,1516699404688,1516699404688,1516699404688,1516699404688,1516699404688,1516699404688,1516699404688,1516699404688,1516699404688,1516699404688,1516699404688,1516699404688,1516699404688,1516699404688,1516699404688,1516699404688,1516699404708,1516699404924,1516699405124,1516699405324,1516699405472,1516699405480,1516699405495,1516699405511,1516699405529,1516699405545,1516699405562,1516699405579,1516699405596,1516699405612,1516699405628,1516699405645,1516699405662,1516699405678,1516699405695,1516699405712,1516699405728,1516699405746,1516699405762,1516699405778,1516699405795,1516699405812,1516699405829,1516699405881,1516699405895,1516699405913,1516699405929,1516699405945,1516699405945,1516699405945,1516699405945,1516699405945,1516699405945,1516699405945,1516699405945,1516699405945,1516699405945,1516699405945,1516699405945,1516699405945,1516699405945,1516699405945,1516699405945,1516699405945,1516699405945,1516699405945,1516699405945,1516699405945,1516699405945,1516699405945,1516699405945,1516699406324,1516699406524,1516699406724,1516699406755,1516699406762,1516699406778,1516699406795,1516699406812,1516699406829,1516699406845,1516699406862,1516699406879,1516699406896,1516699406912,1516699406930,1516699406946,1516699406962,1516699406979,1516699406995,1516699407012,1516699407029,1516699407046,1516699407062,1516699407079,1516699407096,1516699407113,1516699407147,1516699407342,1516699407356,1516699407363,1516699407379,1516699407395,1516699407412,1516699407428,1516699407446,1516699407463,1516699407479,1516699407497,1516699407513,1516699407530,1516699407546,1516699407563,1516699407928,1516699408081,1516699408086],\"dialog_type\":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,72,0,72,72,0,72,72,0,0,0,72,0,0,0,0,0,0,0,0,0,0,0,0,0,73,73,73,0,0,0,0,0,0,73,0,0,0,0,73,0,0,0,0,0,0,73,0,73,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,73,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\"op_x\":[416,416,570,624,631,663,677,690,698,705,707,709,710,710,711,714,718,721,725,730,735,739,743,745,746,747,747,747,747,747,747,747,747,747,747,747,747,747,747,747,747,747,747,747,747,747,747,747,747,747,747,747,747,747,745,742,737,707,633,539,367,266,209,178,178,234,310,395,486,541,605,656,682,702,723,728,733,741,750,757,762,767,771,771,771,771,771,771,771,771,771,771,771,771,771,771,771,771,771,771,771,771,771,771,771,771,771,771,771,771,771,771,771,771,771,771,771,771,771,771,770,770,769,765,760,751,740,728,725,720,716,714,711,709,709,709,709,0,709,0,0,709,0,0,709,709,708,0,704,695,691,686,682,680,678,675,674,672,670,670,670,0,0,0,670,672,674,677,686,690,0,694,704,712,716,0,717,725,727,728,729,729,0,729,0,729,730,730,730,730,730,730,730,730,730,730,730,730,730,730,730,730,730,730,730,730,730,730,730,730,730,0,730,730,730,730,729,728,727,726,725,725,724,724,724,724,724,724,724,724,728,734,743,750,754,756,757,758,758,758,758,758,758,758,758,758,758,758,758,758,758,758,758,758,758,758,758,758,758,758,758,758,758,758,758,758,758,758,758,757,757,755,754,750,746,742,739,736,733,730,727,724,721,716,713,711,710,709,708,708,708,708,708,708,708,708,708,709,710,716,724,731,737,742,745,746,747,747,747,747,747],\"op_y\":[317,317,267,246,247,254,255,257,257,256,256,255,255,255,255,255,254,253,252,250,249,247,246,246,245,245,245,244,244,244,244,243,243,242,241,241,240,237,229,218,206,192,182,170,146,135,124,114,104,94,85,77,241,241,69,69,69,70,78,94,132,159,174,183,183,183,161,138,115,102,86,69,58,47,53,56,59,64,69,74,77,81,85,85,86,88,90,93,99,115,120,126,132,137,141,145,149,152,155,156,158,160,162,164,166,168,170,172,174,176,179,180,183,185,186,187,188,85,85,85,189,189,189,188,188,187,186,185,184,183,182,181,181,181,181,181,181,0,181,0,0,181,0,0,181,183,185,0,192,206,213,223,231,234,239,242,245,248,250,250,250,0,0,0,250,250,250,249,247,245,0,244,242,240,239,0,239,238,238,238,238,238,0,237,0,237,237,237,237,238,240,242,245,258,270,281,292,298,310,334,345,356,367,377,387,396,403,403,407,407,407,0,237,237,237,404,404,404,404,404,402,401,400,399,398,398,397,396,395,392,386,378,366,357,352,349,347,347,347,348,348,349,349,349,348,346,343,340,334,329,322,316,312,310,308,305,304,303,302,301,301,301,301,301,302,303,349,349,304,304,304,305,306,308,312,316,319,322,324,328,331,335,342,352,356,360,363,365,365,366,366,367,367,367,366,366,366,365,363,357,348,340,334,328,325,324,324,324,324,324,324]}","true_info":"{\"second_x\":343,\"second_y\":343,\"scenario\":0,\"terminal\":0,\"first_x\":582,\"first_y\":299}"}
    params = {"event_info":{"Time": [1515639896196, 1515639896296]},"true_info":{"correct_x": 595.0, "correct_y": 302.5, "slidebarleft_x": 529.0, "slidebarleft_y": 457.5, "slidebarright_x": 565.0, "slidebarright_y": 493.5, "scenario": 0, "terminal": 0}}
    handle(params)